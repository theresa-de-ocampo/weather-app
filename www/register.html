<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="author" content="Theresa De Ocampo" />
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="format-detection" content="telephone=yes">
	<meta name="msapplication-tap-highlight" content="no">
	<meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
	<link rel="stylesheet" type="text/css" href="css/all.min.css" />
	<link rel="stylesheet" type="text/css" href="css/general.css" />
	<link rel="stylesheet" type="text/css" href="css/login-registration.css" />
	<link rel="stylesheet" type="text/css" href="css/validation.css" />
	<title>WWÜ</title>
</head>
<body>
	<header class="curved"><h1>Welcome</h1></header>
	<form method="post" novalidate>
		<label for="fname">First Name <span class="required">*</span></label>
		<input id="fname" type="text" name="fname" required />

		<label for="lname">Last Name <span class="required">*</span></label>
		<input id="lname" type="text" name="lname" required />
		
		<label for="contact-no">Contact No. <span class="required">*</span></label>
		<input id="contact-no" type="text" name="contact-no" required />

		<label for="location">City & Country Code <span class="required">*</span></label>
		<input id="location" type="text" name="location" required />

		<label for="email">Email <span class="required">*</span></label>
		<input id="email" type="email" name="email" required />

		<label for="password">Password <span class="required">*</span></label>
		<input id="password" type="password" name="password" required />

		<label for="confirm-password">Confirm Password <span class="required">*</span></label>
		<input id="confirm-password" type="password" name="confirm-password" required />

		<input id="show-passwords" type="checkbox" class="show-password" />
		<label for="show-passwords" class="inline show-password-label">Show Passwords</label>

		<a href="login.html">Already have an account?</a>
		<button id="sign-up" type="submit">SIGN UP</button>
	</form>

	<script src="cordova.js"></script>
	<script src="js/jquery-3.6.0.min.js"></script>
	<script src="js/open-weather-map.js"></script>
	<script src="js/show-password.js"></script>
	<script src="js/validation.js"></script>
	<script src="js/crypto-4.1.1.min.js"></script>
	<script src="js/crypto.js"></script>
	<script src="js/register.js"></script>
	<script type="module">
		// jshint esversion: 6
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
		const firebaseConfig = {
			apiKey: "AIzaSyCfDbjM-Ex2pooaDUZpry42-7WZlIimMoQ",
			authDomain: "weather-app-d05dd.firebaseapp.com",
			projectId: "weather-app-d05dd",
			storageBucket: "weather-app-d05dd.appspot.com",
			messagingSenderId: "721434338443",
			appId: "1:721434338443:web:f96b62f80fe467a34aa08e"
		};
		const app = initializeApp(firebaseConfig);

		import {getDatabase, ref, get, set, child, update, remove}
			from "https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js";
		const database = getDatabase();

		$("form").on("submit", function(e) {
			if (validate(e, true)) {
				const id = generateId();
				const data = {
					"id": id,
					"fname": $("#fname").val(),
					"lname": $("#lname").val(),
					"contact-no": $("#contact-no").val(),
					"location": $("#location").val(),
					"email": $("#email").val(),
					"password": crypto.encrypt($("#password").val())
				};
				insertRecord(data, id);
			}
		});

		function insertRecord(data, id) {
			set(ref(database, "user/" + id), data)
			.then(() => {
				navigator.notification.alert("Your account was successfully created!", null, "WWÜ");
				window.location.replace("index.html");
			})
			.catch(error => navigator.notification.alert("[ERROR] " + error, null, "WWÜ"));
		}
	</script>
</body>
</html>